<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Nutrition Analyzer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f7f7f7; }
        .container { background: #fff; padding: 24px; border-radius: 8px; max-width: 500px; margin: auto; box-shadow: 0 2px 8px #ccc; }
        h2 { text-align: center; }
        input[type="file"] { margin-bottom: 16px; }
        button { padding: 8px 16px; font-size: 16px; }
        #result { margin-top: 24px; white-space: pre-wrap; background: #f0f0f0; padding: 12px; border-radius: 6px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Food Nutrition Analyzer</h2>
        <form id="uploadForm">
            <input type="file" id="imageInput" accept="image/*" required><br>
            <button type="submit">Analyze Food Image</button>
        </form>
        <div id="result"></div>
    </div>
    <script>
        const form = document.getElementById('uploadForm');
        const resultDiv = document.getElementById('result');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            resultDiv.textContent = 'Analyzing...';
            const fileInput = document.getElementById('imageInput');
            if (!fileInput.files.length) {
                resultDiv.textContent = 'Please select an image.';
                return;
            }
            const file = fileInput.files[0];
            
            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                resultDiv.textContent = 'Please select a valid image file (JPEG, PNG, GIF, or WebP).';
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            try {
                const response = await fetch('http://localhost:8000/analyze-food', {
                    method: 'POST',
                    body: formData
                });
                if (!response.ok) {
                    let errorMessage = 'An error occurred while analyzing the image.';
                    try {
                        const error = await response.json();
                        errorMessage = error.detail || response.statusText;
                    } catch {
                        errorMessage = response.statusText;
                    }
                    resultDiv.textContent = 'Error: ' + errorMessage;
                } else {
                    const data = await response.json();
                    // Display formatted results
                    let html = '<h3>Analysis Results</h3>';
                    html += '<p><strong>Food:</strong> ' + data.food_identification.primary_dish + ' (' + data.food_identification.confidence + '% confidence)</p>';
                    html += '<p><strong>Category:</strong> ' + data.food_identification.food_category + '</p>';
                    
                    html += '<h4>Macronutrients</h4>';
                    html += '<ul>';
                    html += '<li>Calories: ' + data.macronutrients.calories + '</li>';
                    html += '<li>Protein: ' + data.macronutrients.protein + 'g</li>';
                    html += '<li>Carbohydrates: ' + data.macronutrients.carbohydrates + 'g</li>';
                    html += '<li>Fiber: ' + data.macronutrients.fiber + 'g</li>';
                    html += '<li>Fat: ' + data.macronutrients.fat + 'g</li>';
                    html += '<li>Saturated Fat: ' + data.macronutrients.saturated_fat + 'g</li>';
                    html += '<li>Sodium: ' + data.macronutrients.sodium + 'mg</li>';
                    html += '</ul>';
                    
                    html += '<h4>Health Assessment</h4>';
                    html += '<p><strong>Status:</strong> ' + data.health_assessment.status + ' (Score: ' + data.health_assessment.score + ')</p>';
                    html += '<p><strong>Reasons:</strong></p><ul>';
                    data.health_assessment.reasons.forEach(reason => {
                        html += '<li>' + reason + '</li>';
                    });
                    html += '</ul>';
                    
                    resultDiv.innerHTML = html;
                }
            } catch (err) {
                resultDiv.textContent = 'Request failed: ' + err.message;
            }
        });
    </script>
</body>
</html>
